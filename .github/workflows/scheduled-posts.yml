name: ì˜ˆì•½ í¬ìŠ¤íŒ…

on:
  schedule:
    # ë§¤ì¼ 3íšŒ: ì˜¤ì „ 9ì‹œ, ì˜¤í›„ 2ì‹œ, ì˜¤í›„ 8ì‹œ (KST)
    - cron: '0 0 * * *'   # 09:00 KST
    - cron: '0 5 * * *'   # 14:00 KST
    - cron: '0 11 * * *'  # 20:00 KST

  workflow_dispatch:
    inputs:
      keywords:
        description: 'í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)'
        required: true
        default: 'ë¬´ì„ ì´ì–´í°,ë¸”ë£¨íˆ¬ìŠ¤ìŠ¤í”¼ì»¤,ë³´ì¡°ë°°í„°ë¦¬'

jobs:
  scheduled-post:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - run: npm ci

      - name: í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        run: |
          cat > .env << EOF
          COUPANG_ACCESS_KEY=${{ secrets.COUPANG_ACCESS_KEY }}
          COUPANG_SECRET_KEY=${{ secrets.COUPANG_SECRET_KEY }}
          WP_SITE_URL=${{ secrets.WP_SITE_URL }}
          WP_USERNAME=${{ secrets.WP_USERNAME }}
          WP_APP_PASSWORD=${{ secrets.WP_APP_PASSWORD }}
          TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}
          REQUEST_DELAY_MS=1000
          MAX_RETRIES=3
          TIMEOUT_MS=10000
          EOF

      - name: ğŸ² ëœë¤ í‚¤ì›Œë“œ ì„ íƒ & í¬ìŠ¤íŒ…
        run: |
          # í‚¤ì›Œë“œ ëª©ë¡
          KEYWORDS=("ë¬´ì„ ì´ì–´í°" "ë¸”ë£¨íˆ¬ìŠ¤ìŠ¤í”¼ì»¤" "ë³´ì¡°ë°°í„°ë¦¬" "ì¶©ì „ì¼€ì´ë¸”" "ìŠ¤ë§ˆíŠ¸ì›Œì¹˜" "íƒœë¸”ë¦¿ê±°ì¹˜ëŒ€" "ë…¸íŠ¸ë¶íŒŒìš°ì¹˜")

          # ëœë¤ ì„ íƒ
          RANDOM_INDEX=$((RANDOM % ${#KEYWORDS[@]}))
          KEYWORD="${KEYWORDS[$RANDOM_INDEX]}"

          echo "ğŸ¯ ì„ íƒëœ í‚¤ì›Œë“œ: $KEYWORD"
          echo "keyword=$KEYWORD" >> $GITHUB_OUTPUT

          # í¬ìŠ¤íŒ… ì‹¤í–‰
          npm run publish "$KEYWORD" 5

      - name: ğŸ“± í…”ë ˆê·¸ë¨ ì•Œë¦¼
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "âœ… í¬ìŠ¤íŒ… ì„±ê³µ ì•Œë¦¼ ì „ì†¡"
          else
            echo "âŒ í¬ìŠ¤íŒ… ì‹¤íŒ¨ ì•Œë¦¼ ì „ì†¡"
          fi
        continue-on-error: true
