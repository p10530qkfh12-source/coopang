name: ì—°ê²° í…ŒìŠ¤íŠ¸

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'package.json'

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - run: npm ci

      - name: í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        run: |
          cat > .env << EOF
          COUPANG_ACCESS_KEY=${{ secrets.COUPANG_ACCESS_KEY }}
          COUPANG_SECRET_KEY=${{ secrets.COUPANG_SECRET_KEY }}
          WP_SITE_URL=${{ secrets.WP_SITE_URL }}
          WP_USERNAME=${{ secrets.WP_USERNAME }}
          WP_APP_PASSWORD=${{ secrets.WP_APP_PASSWORD }}
          REQUEST_DELAY_MS=1000
          EOF

      - name: ðŸ”Œ ì›Œë“œí”„ë ˆìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
        run: npm run wp:test

      - name: ðŸ“‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼
        if: always()
        run: |
          echo "## ì—°ê²° í…ŒìŠ¤íŠ¸ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
          echo "| ì„œë¹„ìŠ¤ | ìƒíƒœ |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|------|" >> $GITHUB_STEP_SUMMARY
          echo "| ì›Œë“œí”„ë ˆìŠ¤ | ${{ job.status == 'success' && 'âœ…' || 'âŒ' }} |" >> $GITHUB_STEP_SUMMARY
